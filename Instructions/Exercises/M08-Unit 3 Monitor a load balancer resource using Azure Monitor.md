---
Exercise:
  title: M08 - 단원 3 Azure Monitor를 사용하여 부하 분산 장치 리소스 모니터링
  module: Module 08 - Design and implement network monitoring
---

# M08-단원 3 Azure Monitor를 사용하여 부하 분산 장치 리소스 모니터링

## 연습 시나리오

이 연습에서는 가상의 Contoso Ltd 조직에 대한 내부 부하 분산 장치를 만듭니다. 그런 다음 Log Analytics 작업 영역을 만들고 Azure Monitor Insights를 사용하여 내부 부하 분산 장치에 대한 정보를 확인합니다. 함수 종속성 보기를 확인한 후 부하 분산 장치 리소스에 대한 자세한 메트릭을 보고 부하 분산 장치에 대한 리소스 상태 정보를 확인합니다. 마지막으로 생성된 Log Analytics 작업 영역에 메트릭을 보내도록 부하 분산 장치의 진단 설정을 구성합니다.

아래 다이어그램은 이 연습에서 배포하는 환경을 보여 줍니다.

![연습에서 생성되는 부하 분산 장치 아키텍처를 보여 주는 다이어그램 - 부하 분산 장치, VNet, 서브넷, Bastionsubnet 및 VM 포함](../media/3-exercise-monitor-load-balancer-resource-using-azure-monitor.png)

### 작업 기술

 이 연습에서 다음을 수행합니다.

+ 작업 1: 가상 네트워크 만들기
+ 작업 2: 부하 분산 장치 만들기
+ 작업 3: 백 엔드 풀 만들기
+ 작업 4: 상태 프로브 만들기
+ 작업 5: 부하 분산 장치 규칙 만들기
+ 작업 6: 백 엔드 서버 만들기
+ 작업 7: 백 엔드 풀에 VM 추가
+ 작업 8: 부하 분산 장치 테스트
+ 작업 9: Log Analytics 작업 영역 만들기
+ 작업 10: 함수 종속성 뷰 사용
+ 작업 11: 자세한 메트릭 보기
+ 작업 12: 리소스 상태 보기
+ 작업 13: 진단 설정 구성

### 예상 시간: 55분

## 작업 1: 가상 네트워크 만들기

이 섹션에서는 가상 네트워크와 서브넷을 만듭니다.

1. Azure 포털에 로그인합니다.

1. Azure Portal에서 **가상 네트워크**를 검색하여 선택합니다.

1. **+ 만들기**를 선택합니다.

   ![가상 네트워크 만들기](../media/create-virtual-network.png)

1. **기본** 탭에서 아래 표의 정보를 사용하여 가상 네트워크를 만듭니다.

   | **설정**    | **값**                                           |
   | -------------- | --------------------------------------------------- |
   | 구독   | 구독 선택                            |
   | Resource group | **새로 만들기**를 선택합니다.<br /><br />이름: **IntLB-RG** |
   | 속성           | **IntLB-VNet**                                      |
   | 지역         | **(미국) 미국 서부**                                    |

1. **다음: 보안**을 선택합니다.

1. **BastionHost**에서 **사용**을 선택한 후 아래 표의 정보를 입력합니다.

    | **설정**                       | **값**                                              |
    | --------------------------------- | ------------------------------------------------------ |
    | Bastion 이름                      | **myBastionHost**                                      |
    | 공용 IP 주소                 | **새로 만들기**를 선택합니다.<br /><br />이름: **myBastionIP** |

1. **다음 : IP 주소**를 선택합니다.

1. **IP 주소를 삭제**한 다음, **IPv4 주소 공간**을 삭제합니다. **10.1.0.0/16**을 입력합니다.

1. **AzureBastionSubnet**을 편집하고 **시작 주소**를 **10.1.1.0**으로 변경합니다. 변경 내용을 **저장**합니다. 

1. **+ 서브넷 추가**를 선택합니다. 서브넷 이름은 `myBackendSubnet`이고, 서브넷 주소 범위는 `10.1.0.0/24`입니다. **추가**를 선택합니다.

1. 이제 두 개의 서브넷이 있는 가상 네트워크가 있습니다. 

1. **검토 + 만들기**를 선택합니다.

1. **만들기**를 선택합니다.

## 작업 2: 부하 분산 장치 만들기

이 섹션에서는 내부 표준 SKU 부하 분산 장치를 만듭니다. 이 연습에서 기본 SKU 부하 분산 장치 대신 표준 SKU 부하 분산 장치를 만드는 이유는, 표준 SKU 버전의 부하 분산 장치가 필요한 이후 연습을 위한 것입니다.

1. Azure Portal에서 **Load Balancer**를 검색하고 선택합니다.

1. **만들기**를 선택한 다음, **표준 Load Balancer**를 선택합니다.

1. **기본** 탭에서 아래 표의 정보를 사용하여 부하 분산 장치를 만듭니다.

   | **설정**           | **값**                |
   | --------------------- | ------------------------ |
   | 기본 사항 탭            |                          |
   | Subscription          | 구독 선택 |
   | Resource group        | **IntLB-RG**             |
   | 속성                  | **myIntLoadBalancer**    |
   | 지역                | **(미국) 미국 서부**         |
   | SKU                   | **표준**             |
   | 형식                  | **내부**             |

1. **프런트 엔드 IP 구성** 탭으로 이동하고 **+ 프런트 엔드 IP 구성 추가**를 선택합니다.

   | **설정**            | **값**            |
   | 이름                  | `LoadBalancerFrontEnd` |
   | 가상 네트워크       | **IntLB-VNet**           |
   | 서브넷                | **myBackendSubnet**      |
   | IP 주소 할당 | **동적**              |

1. 변경 내용을 **저장**한 다음, **검토 + 만들기**를 선택합니다.

1. 유효성 검사에 성공하면 **만들기**를 선택합니다.

## 작업 3: 백 엔드 풀 만들기

백 엔드 주소 풀에는 부하 분산 장치에 연결된 가상 NIC의 IP 주소가 포함됩니다.

1. Azure Portal에서 **myIntLoadBalancer** 리소스를 검색하고 선택합니다.

1. **설정**에서 **백 엔드 풀**을 선택한 다음, **추가**를 선택합니다.

1. **백 엔드 풀 추가** 페이지에 아래 표의 정보를 입력합니다.

   | **설정**     | **값**            |
   | --------------- | -------------------- |
   | 속성            | **myBackendPool**    |
   | 가상 네트워크 | IntLB-VNet    |
   | 백 엔드 풀 구성   | **NIC** |

1. **저장**을 선택합니다.

   ![부하 분산 장치에서 만든 백 엔드 풀 표시](../media/create-backendpool.png)

## 작업 4: 상태 프로브 만들기

부하 분산 장치는 상태 프로브를 사용하여 앱의 상태를 모니터링합니다. 상태 프로브는 상태 검사의 응답에 따라 부하 분산 장치에서 VM을 추가하거나 제거합니다. 여기서는 VM 상태를 모니터링하는 상태 프로브를 만듭니다.

1. 부하 분산 장치 리소스의 경우 **설정**을 선택하고 **상태 프로브**를 선택한 다음, **추가**를 선택합니다.

1. **상태 프로브 추가** 페이지에서 아래 표의 정보를 입력합니다.

   | **설정**         | **값**         |
   | ------------------- | ----------------- |
   | 속성                | `myHealthProbe` |
   | 프로토콜            | **HTTP**          |
   | 포트                | **80**            |
   | 경로                | **/**             |
   | 간격            | **15**            |

1. **저장**을 선택합니다.

   ![부하 분산 장치에서 만든 상태 프로브 표시](../media/create-healthprobe.png)

## 작업 5: 부하 분산 장치 규칙 만들기

부하 분산 장치 규칙은 VM으로 트래픽이 분산되는 방법을 정의하는 데 사용됩니다. 들어오는 트래픽에 대한 프런트 엔드 IP 구성 및 트래픽을 받는 백 엔드 IP 풀을 정의합니다. 원본 및 대상 포트는 규칙에 정의됩니다. 여기서는 부하 분산 장치 규칙을 만듭니다.

1. 부하 분산 장치 리소스의 경우 **설정**을 선택하고 **부하 분산 규칙**을 선택한 다음, **추가**를 선택합니다.

   | **설정**            | **값**                |
   | ---------------------- | ------------------------ |
   | 속성                   | **myHTTPRule**           |
   | IP 버전             | **IPv4**                 |
   | 프런트 엔드 IP 주소    | **LoadBalancerFrontEnd** |
   | 백 엔드 풀           | **myBackendPool**        |
   | 프로토콜               | **TCP**                  |
   | 포트                   | **80**                   |
   | 백 엔드 포트           | **80**                   |
   | 상태 프로브           | **myHealthProbe**        |
   | 세션 지속성    | **없음**                 |
   | 유휴 제한 시간(분) | **15**                   |
   | 부동 IP            | **사용 안 함**             |

   ![부하 분산 장치에서 만든 부하 분산 규칙 표시](../media/create-loadbalancerrule.png)

## 작업 6: 백 엔드 서버 만들기

이 섹션에서는 부하 분산 장치의 백 엔드 풀에 대해 VM을 세 개 만들고, VM을 백 엔드 풀에 추가한 다음, 세 VM에 IIS를 설치하여 부하 분산 장치를 테스트합니다.

1. Azure Portal 오른쪽 상단에 있는 Cloud Shell 아이콘을 선택합니다. 필요한 경우 셸을 구성합니다.  
    + **PowerShell**을 선택합니다.
    + **스토리지 계정이 필요하지 않음**과 **구독**을 선택한 다음 **적용**을 선택합니다.
    + 터미널이 생성되고 프롬프트가 표시될 때까지 기다립니다. 

1. Cloud Shell 창의 도구 모음에서 **파일 관리** 아이콘을 선택하고 드롭다운 메뉴에서 **업로드**를 선택한 후 **azuredeploy.json** 및 **azuredeploy.parameters.json** 파일을 Cloud Shell 홈 디렉터리에 업로드합니다.

    > **참고:** 사용자 고유의 구독으로 작업하는 경우 [템플릿 파일](https://github.com/MicrosoftLearning/AZ-700-Designing-and-Implementing-Microsoft-Azure-Networking-Solutions/tree/master/Allfiles/Exercises)은 랩 리포지토리에서 사용할 수 있습니다.

1. 다음 ARM 템플릿을 배포하여 이 연습에 필요한 가상 네트워크, 서브넷 및 VM을 만듭니다. **참고**: 관리 암호를 입력하라는 메시지가 표시됩니다.

   ```powershell
   $RGName = "IntLB-RG"
   New-AzResourceGroupDeployment -ResourceGroupName $RGName -TemplateFile azuredeploy.json -TemplateParameterFile azuredeploy.parameters.json
   ```
1. 배포하는 데 몇 분 정도 걸릴 수 있습니다. 가상 머신 리소스 페이지를 새로 고쳐 포털에서 진행률을 확인할 수 있습니다.   

## 작업 7: 백 엔드 풀에 VM 추가

1. Azure Portal에서 **myIntLoadBalancer** 리소스를 검색하고 선택합니다.

1. **설정**에서 **백 엔드 풀**과 **myBackendPool**을 차례로 선택합니다.

1. **IP 구성** 섹션에서 **추가**를 선택합니다.

1. 표시되는 모든 가상 머신을 선택한 다음, **추가**를 선택합니다.

1. **myVM1** 및 **myVM2**에 대한 확인란을 선택한 다음, **추가**를 선택합니다.

1. **myBackendPool** 페이지에서 **저장**을 선택합니다.

## 작업 8: 부하 분산 장치 테스트

이 섹션에서는 테스트 VM을 만들어서 부하 분산 장치를 테스트합니다.

### 테스트 VM(VM3)에 연결하여 부하 분산 장치 테스트

1. Azure Portal에서 **myIntLoadBalancer** 리소스를 검색하고 선택합니다.

1. **개요** 페이지에 있는 **개인 IP 주소**를 기록하거나 클립보드에 복사합니다. 참고: **개인 IP 주소**를 보려면 **자세히 보기**를 선택해야 할 수 있습니다.

1. **myVM3**을 검색하여 선택합니다. 

1. **연결**을 선택한 다음, **Bastion을 통해 연결**합니다.

1. **사용자 이름** 상자에 **TestUser**를 입력하고 **암호** 상자에 배포 중에 제공한 암호를 입력한 다음 **연결**을 선택합니다.

1. **myTestVM** 창이 다른 브라우저 탭에서 열립니다.

1. **네트워크** 창이 나타나면 **예**를 선택합니다.

1. 작업 표시줄에서 **Internet Explorer** 아이콘을 선택하여 웹 브라우저를 엽니다.

1. **Internet Explorer 11 설정** 대화 상자에서 **확인**을 선택합니다.

1. 부하 분산 장치 IP 주소(예: 10.1.0.4)를 입력하거나 붙여넣습니다.

1. 두 백 엔드 서버 가상 머신(myVM1 또는 myVM2) 중 하나가 응답합니다. 페이지를 계속 새로 고치면 백 엔드 서버에서 응답이 임의로 수신됩니다. 

## 작업 9:: Log Analytics 작업 영역 만들기

1. Azure Portal에서 **Log analytics 작업 영역** 리소스를 검색하고 선택합니다.
   
1. **만들기**를 실행합니다.

1. **Log Analytics 작업 영역 만들기** 페이지의 **기본** 탭에서 아래 표의 정보를 사용하여 작업 영역을 만듭니다.

   | **설정**    | **값**                |
   | -------------- | ------------------------ |
   | 구독   | 구독 선택 |
   | Resource group | **IntLB-RG**             |
   | 속성           | **myLAworkspace**        |
   | 지역         | **미국 서부**              |

1. **검토 + 만들기**, **만들기**를 차례로 선택합니다.

## 작업 10: 함수 종속성 뷰 사용

1. Azure Portal에서 **myIntLoadBalancer** 리소스를 검색하고 선택합니다. 

   ![Azure Portal의 모든 리소스 목록](../media/network-insights-functional-dependency-view-1.png)

1. **모니터링**에서 **인사이트**를 선택합니다.

1. 메트릭 창에서는 막대형 차트와 꺽은선형 차트 형식으로 이 부하 분산 장치 리소스에 대한 일부 주요 메트릭을 빠르게 볼 수 있습니다.

    ![Azure Monitor Network Insights - 기본 메트릭 보기](../media/network-insights-basicmetrics-view.png)

## 작업 11: 자세한 메트릭 보기

1. 이 네트워크 리소스에 대한 보다 포괄적인 메트릭을 보려면 **자세한 메트릭 보기**를 선택합니다.
   ![Azure Monitor Network Insights - 자세한 메트릭 보기 단추 강조 표시](../media/network-insights-detailedmetrics-1.png)

1. 그러면 Azure Network Insights 플랫폼에서 큰 전체 **메트릭** 페이지가 열립니다. 표시되는 첫 번째 탭은 부하 분산 장치의 가용성 상태와 부하 분산 장치에 연결된 각 프런트 엔드 IP에 대한 전체 데이터 처리량과 프런트 엔드 및 백 엔드 가용성을 보여 주는 **개요** 탭입니다. 이러한 메트릭은 프런트 엔드 IP가 응답하고 백 엔드 풀의 컴퓨팅 인스턴스가 인바운드 연결에 개별적으로 반응하는지 여부를 나타냅니다.
   ![Azure Monitor Network Insights - 자세한 메트릭 보기 - 개요 탭](../media/network-insights-detailedmetrics-2.png)

1. **프런트 엔드 &amp; 백 엔드 가용성** 탭을 선택하고 페이지 아래로 스크롤하여 상태 프로브 상태 차트를 확인합니다. 항목에 대해 **100보다 작은 값**이 표시되면 해당 리소스에 대한 일종의 중단을 나타냅니다.
   ![Azure Monitor Network Insights - 자세한 메트릭 보기 - 상태 프로브 상태 차트 강조 표시](../media/network-insights-detailedmetrics-5.png)

1. **데이터 처리량** 탭을 선택하고 페이지 아래로 스크롤하여 다른 데이터 처리량 차트를 확인합니다.

1. 차트의 데이터 요소 중 일부를 마우스로 가리키면 값이 변경되어 해당 시점의 정확한 값이 표시됩니다.
   ![Azure Monitor Network Insights - 자세한 메트릭 보기 - 데이터 처리량 탭](../media/network-insights-detailedmetrics-3.png)

1. **흐름 분포** 탭을 선택하고 페이지를 아래로 스크롤하여 **VM 흐름 만들기 및 네트워크 트래픽** 섹션 아래의 차트를 확인합니다.

   ![Azure Monitor Network Insights - 자세한 메트릭 보기 - VM 흐름 만들기 및 네트워크 트래픽 차트](../media/network-insights-detailedmetrics-4.png)

## 작업 12: 리소스 상태 보기

1. Load Balancer 리소스의 상태를 보려면 Azure Portal 홈페이지에서 **모든 서비스**를 선택한 다음 **모니터**를 선택합니다.

1. **모니터&gt;개요** 페이지의 왼쪽 메뉴에서 **Service Health**를 선택합니다.

1. **Service Health&gt;서비스 문제** 페이지의 왼쪽 메뉴에서 **Resource Health**를 선택합니다.

1. **Service Health&gt;Resource Health** 페이지의 **리소스 종류** 드롭다운 목록에서 아래로 스크롤하여 **부하 분산 장치**를 선택합니다.

   ![부하 분산 장치 리소스의 서비스 상태>리소스 상태 액세스](../media/resource-health-1.png)

1. 그런 다음 목록에서 부하 분산 장치의 이름을 선택합니다.

1. **Resource Health** 페이지에서는 부하 분산 장치 리소스의 주요 가용성 문제를 식별합니다. **상태 기록** 섹션에 이벤트가 있는 경우 상태 이벤트를 확장하여 이벤트에 대한 자세한 내용을 볼 수 있습니다. 나중에 검토하고 보고할 수 있도록 이벤트에 대한 세부 정보를 PDF 파일로 저장할 수 있습니다.

   ![서비스 상태>리소스 상태 뷰](../media/resource-health-2.png)

## 작업 13: 진단 설정 구성

1. Azure Portal 홈페이지에서 **리소스 그룹**을 선택한 다음 목록에서 **IntLB-RG** 리소스 그룹을 선택합니다.

1. **IntLB-RG** 페이지의 리소스 목록에서 **myIntLoadBalancer** 부하 분산 장치 리소스 이름을 선택합니다.

1. **모니터링**에서 **진단 설정**을 선택한 다음 **진단 설정 추가**를 선택합니다.

   ![진단 설정>진단 설정 추가 단추가 강조 표시된 화면](../media/diagnostic-settings-1.png)

1. **진단 설정** 페이지의 이름 상자에 **myLBDiagnostics**를 입력합니다.

1. **AllMetrics** 확인란을 선택한 다음 **Log Analytics 작업 영역에 보내기** 확인란을 선택합니다.

1. 목록에서 구독을 선택한 후 작업 영역 드롭다운 목록에서 **myLAworkspace(westus)** 를 선택합니다.

1. **저장**을 선택합니다.

   ![부하 분산 장치에 대한 진단 설정 페이지](../media/diagnostic-settings-2.png)

## 리소스 정리

>**참고**: 더 이상 사용하지 않는 새로 만든 Azure 리소스는 모두 제거하세요. 사용되지 않는 리소스를 제거하면 예기치 않은 요금이 발생하지 않습니다.

1. Azure Portal의 **Cloud Shell** 창에서 **PowerShell** 세션을 엽니다.

1. 다음 명령을 실행하여 이 모듈의 랩 전체에서 만든 모든 리소스 그룹을 삭제합니다.

   ```powershell
   Remove-AzResourceGroup -Name 'IntLB-RG' -Force -AsJob
   ```

>**참고**: 이 명령은 -AsJob 매개 변수에 의해 결정되어 비동기로 실행되므로, 동일한 PowerShell 세션 내에서 이 명령을 실행한 직후 다른 PowerShell 명령을 실행할 수 있지만 리소스 그룹이 실제로 제거되기까지는 몇 분 정도 걸립니다.
    
## Copilot을 사용하여 학습 확장

Copilot은 Azure 스크립팅 도구를 사용하는 방법을 익히는 데 도움을 줍니다. 또한 Copilot은 랩에서 다루지 않는 영역이나 추가 정보가 필요한 영역을 지원할 수 있습니다. Edge 브라우저를 열고 Copilot(오른쪽 위)을 선택하거나 *copilot.microsoft.com*으로 이동하세요. 몇 분 정도 시간을 내어 이러한 프롬프트를 사용해 보세요.
+ 가상 네트워크를 모니터링하는 데 사용할 수 있는 Azure 도구를 요약합니다.
+ 사용할 수 있는 Azure Network Watcher 모니터링 도구로는 무엇이 있나요?

## 자기 주도적 학습을 통해 자세히 알아보기

+ [Azure Monitor 소개](https://learn.microsoft.com/training/modules/intro-to-azure-monitor/). 이 모듈에서는 Azure Monitor를 사용하여 Azure 리소스 성능 및 작업에 대한 인사이트를 얻는 방법을 알아봅니다.
+ [네트워크 모니터링 도구를 사용하여 엔드투엔드 Azure 네트워크 인프라 모니터링 및 문제 해결](https://learn.microsoft.com/training/modules/troubleshoot-azure-network-infrastructure/). 이 모듈에서는 Azure 인프라에서 네트워킹 문제를 찾아 해결하는 데 도움이 되는 Azure Network Watcher 도구, 진단, 로그를 사용하는 방법을 알아봅니다.

## 핵심 내용

축하합니다. 랩을 완료했습니다. 이 랩의 주요 내용은 다음과 같습니다. 

+ Azure Monitor는 모든 Azure, 다른 클라우드 및 온-프레미스 리소스에서 IT 데이터를 수집, 관리 및 분석하기 위한 기능과 도구를 제공합니다.
+ 메트릭은 애플리케이션 또는 리소스 성능의 스냅샷을 보여 주는 정량적 측정값입니다. 메트릭은 일반적으로 시간이 지남에 따라 측정할 수 있는 숫자 값입니다.
+ 로그는 리소스나 애플리케이션에서 발생하는 이벤트, 작업 및 메시지에 대한 텍스트 기록입니다. 
+ Azure Monitor Insights, 시각화, 대시보드는 애플리케이션에 대한 모니터링 정보를 사용하고 전송할 수 있습니다.
+ 경고는 위험 상황을 알리고 정정 작업을 수행할 수 있습니다. 경고 규칙은 메트릭 또는 로그 데이터를 기반으로 할 수 있습니다.+ 
    
